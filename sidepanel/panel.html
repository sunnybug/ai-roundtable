<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Panel</title>
  <link rel="stylesheet" href="panel.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <h1>AI 圆桌</h1>
        <button class="settings-btn" id="settings-btn" title="设置">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6"></path>
            <path d="m1 12 6-1m8 12 1-6M12 1l-1 6m12 8-6 1M1 12l1 6m6-12-6-1"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Mode Switcher -->
    <section class="mode-switcher">
      <button class="mode-btn active" id="mode-normal">普通</button>
      <button class="mode-btn" id="mode-discussion">讨论</button>
    </section>

    <!-- Normal Mode Content -->
    <div id="normal-mode">
      <section class="targets">
      <label class="target-label">
        <input type="checkbox" id="target-claude" checked>
        <span class="target-name claude">Claude</span>
        <span class="status" id="status-claude">-</span>
        <span class="response-indicator" id="response-indicator-claude" title="有回复">✓</span>
        <button class="response-btn" id="response-claude" title="查看当前回答">💬</button>
        <button class="launch-btn" id="launch-claude" title="在新标签页中打开 Claude">🚀</button>
      </label>
      <label class="target-label">
        <input type="checkbox" id="target-chatgpt" checked>
        <span class="target-name chatgpt">ChatGPT</span>
        <span class="status" id="status-chatgpt">-</span>
        <span class="response-indicator" id="response-indicator-chatgpt" title="有回复">✓</span>
        <button class="response-btn" id="response-chatgpt" title="查看当前回答">💬</button>
        <button class="launch-btn" id="launch-chatgpt" title="在新标签页中打开 ChatGPT">🚀</button>
      </label>
      <label class="target-label">
        <input type="checkbox" id="target-gemini" checked>
        <span class="target-name gemini">Gemini</span>
        <span class="status" id="status-gemini">-</span>
        <span class="response-indicator" id="response-indicator-gemini" title="有回复">✓</span>
        <button class="response-btn" id="response-gemini" title="查看当前回答">💬</button>
        <button class="launch-btn" id="launch-gemini" title="在新标签页中打开 Gemini">🚀</button>
      </label>
      <label class="target-label">
        <input type="checkbox" id="target-chatglm" checked>
        <span class="target-name chatglm">ChatGLM</span>
        <span class="status" id="status-chatglm">-</span>
        <span class="response-indicator" id="response-indicator-chatglm" title="有回复">✓</span>
        <button class="response-btn" id="response-chatglm" title="查看当前回答">💬</button>
        <button class="launch-btn" id="launch-chatglm" title="在新标签页中打开 ChatGLM">🚀</button>
      </label>
      <label class="target-label">
        <input type="checkbox" id="target-aistudio" checked>
        <span class="target-name aistudio">AI Studio</span>
        <span class="status" id="status-aistudio">-</span>
        <span class="response-indicator" id="response-indicator-aistudio" title="有回复">✓</span>
        <button class="response-btn" id="response-aistudio" title="查看当前回答">💬</button>
        <button class="launch-btn" id="launch-aistudio" title="在新标签页中打开 AI Studio">🚀</button>
      </label>
    </section>

    <!-- Mutual Review Section -->
    <section class="mutual-review-section" id="mutual-review-section">
      <div class="mutual-review-header">
        <div class="mutual-header-left">
          <span class="mutual-icon">🔄</span>
          <h3>互评模式</h3>
        </div>
        <button class="mutual-toggle-btn" id="mutual-toggle-btn" title="展开/收起">▼</button>
      </div>
      <div class="mutual-review-content hidden" id="mutual-review-content">

        <!-- 步骤1：选择参与角色 -->
        <div class="mutual-step-section">
          <div class="mutual-role-selection">
            <div class="role-column">
              <div class="role-header">
                <span class="role-icon">🗣️</span>
                <span class="role-title">发言者（被评论）</span>
              </div>
              <div class="role-checkboxes" id="speaker-checkboxes">
                <label class="role-checkbox">
                  <input type="checkbox" value="claude" data-role="speaker">
                  <span class="checkbox-label claude">Claude</span>
                </label>
                <label class="role-checkbox">
                  <input type="checkbox" value="chatgpt" data-role="speaker">
                  <span class="checkbox-label chatgpt">ChatGPT</span>
                </label>
                <label class="role-checkbox">
                  <input type="checkbox" value="gemini" data-role="speaker">
                  <span class="checkbox-label gemini">Gemini</span>
                </label>
                <label class="role-checkbox">
                  <input type="checkbox" value="chatglm" data-role="speaker">
                  <span class="checkbox-label chatglm">ChatGLM</span>
                </label>
                <label class="role-checkbox">
                  <input type="checkbox" value="aistudio" data-role="speaker">
                  <span class="checkbox-label aistudio">AI Studio</span>
                </label>
              </div>
            </div>
            <div class="role-column">
              <div class="role-header">
                <span class="role-icon">💬</span>
                <span class="role-title">评论者</span>
              </div>
              <div class="role-checkboxes" id="reviewer-checkboxes">
                <label class="role-checkbox">
                  <input type="checkbox" value="claude" data-role="reviewer">
                  <span class="checkbox-label claude">Claude</span>
                </label>
                <label class="role-checkbox">
                  <input type="checkbox" value="chatgpt" data-role="reviewer">
                  <span class="checkbox-label chatgpt">ChatGPT</span>
                </label>
                <label class="role-checkbox">
                  <input type="checkbox" value="gemini" data-role="reviewer">
                  <span class="checkbox-label gemini">Gemini</span>
                </label>
                <label class="role-checkbox">
                  <input type="checkbox" value="chatglm" data-role="reviewer">
                  <span class="checkbox-label chatglm">ChatGLM</span>
                </label>
                <label class="role-checkbox">
                  <input type="checkbox" value="aistudio" data-role="reviewer">
                  <span class="checkbox-label aistudio">AI Studio</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- 提示词 -->
        <div class="mutual-prompt-section">
          <label for="mutual-prompt-input">📝 评价提示词（可选）：</label>
          <input
            type="text"
            id="mutual-prompt-input"
            placeholder="例如：重点分析优缺点、有什么值得借鉴的..."
            class="mutual-prompt-input"
          >
        </div>

        <!-- 状态和开始按钮 -->
        <div class="mutual-status" id="mutual-status">
          <div class="mutual-status-text" id="mutual-status-text">请选择参与角色</div>
        </div>
        <button class="mutual-start-btn" id="mutual-start-btn" disabled>开始互评</button>
      </div>
    </section>

    <section class="input-section">
      <textarea
        id="message-input"
        placeholder="输入消息..."
        rows="6"
      ></textarea>
      <div class="input-actions">
        <button id="move-tabs-btn" class="secondary-btn" title="将选中的AI标签移动到新窗口">🪟 移动到新窗口</button>
        <button id="send-btn">发送</button>
      </div>
    </section>
    </div><!-- end normal-mode -->

    <!-- Discussion Mode Content -->
    <div id="discussion-mode" class="hidden">
      <section class="discussion-setup" id="discussion-setup">
        <h3>开始讨论</h3>
        <div class="participant-select">
          <label>参与者：</label>
          <div class="participant-options">
            <label class="participant-option">
              <input type="checkbox" name="participant" value="claude" checked>
              <span class="target-name claude">Claude</span>
            </label>
            <label class="participant-option">
              <input type="checkbox" name="participant" value="chatgpt" checked>
              <span class="target-name chatgpt">ChatGPT</span>
            </label>
            <label class="participant-option">
              <input type="checkbox" name="participant" value="gemini">
              <span class="target-name gemini">Gemini</span>
            </label>
            <label class="participant-option">
              <input type="checkbox" name="participant" value="chatglm">
              <span class="target-name chatglm">ChatGLM</span>
            </label>
            <label class="participant-option">
              <input type="checkbox" name="participant" value="aistudio">
              <span class="target-name aistudio">AI Studio</span>
            </label>
          </div>
          <p class="hint">请选择 2 位参与者</p>
        </div>
        <textarea
          id="discussion-topic"
          placeholder="输入讨论主题...&#10;&#10;示例：微服务架构和单体架构各有什么优缺点？"
          rows="4"
        ></textarea>
        <button id="start-discussion-btn">开始讨论</button>
      </section>

      <section class="discussion-active hidden" id="discussion-active">
        <div class="discussion-header">
          <div class="discussion-info">
            <span class="round-badge" id="round-badge">第 1 轮</span>
            <span class="participants-badge" id="participants-badge">Claude vs ChatGPT</span>
          </div>
          <button class="end-btn" id="end-discussion-btn">结束</button>
        </div>
        <div class="discussion-topic-display" id="topic-display"></div>
        <div class="discussion-status" id="discussion-status">
          等待初始回复...
        </div>
        <div class="discussion-interject">
          <label>插话（同步发送给讨论双方）</label>
          <textarea
            id="interject-input"
            placeholder="输入你想对双方说的话..."
          ></textarea>
          <div class="interject-actions">
            <button id="interject-btn">发送给双方</button>
          </div>
        </div>
        <div class="discussion-controls">
          <button id="next-round-btn" disabled>下一轮</button>
          <button id="generate-summary-btn" disabled>生成总结</button>
        </div>
      </section>

      <section class="discussion-summary hidden" id="discussion-summary">
        <h3>讨论总结</h3>
        <div id="summary-content"></div>
        <button id="new-discussion-btn">新讨论</button>
      </section>
    </div><!-- end discussion-mode -->

    <!-- Settings Modal -->
    <div class="settings-modal hidden" id="settings-modal">
      <div class="settings-overlay"></div>
      <div class="settings-content">
        <div class="settings-header">
          <h2>设置</h2>
          <button class="settings-close" id="settings-close">×</button>
        </div>
        <div class="settings-body">
          <div class="settings-section">
            <h3>显示 AI</h3>
            <p class="settings-hint">选择要在界面中显示的 AI 助手</p>
            <div class="settings-ai-list">
              <label class="settings-ai-item">
                <input type="checkbox" name="visible-ai" value="claude" checked>
                <span class="target-name claude">Claude</span>
              </label>
              <label class="settings-ai-item">
                <input type="checkbox" name="visible-ai" value="chatgpt" checked>
                <span class="target-name chatgpt">ChatGPT</span>
              </label>
              <label class="settings-ai-item">
                <input type="checkbox" name="visible-ai" value="gemini" checked>
                <span class="target-name gemini">Gemini</span>
              </label>
              <label class="settings-ai-item">
                <input type="checkbox" name="visible-ai" value="chatglm" checked>
                <span class="target-name chatglm">ChatGLM</span>
              </label>
              <label class="settings-ai-item">
                <input type="checkbox" name="visible-ai" value="aistudio" checked>
                <span class="target-name aistudio">AI Studio</span>
              </label>
            </div>
          </div>
        </div>
        <div class="settings-footer">
          <button class="settings-save-btn" id="settings-save-btn">保存</button>
        </div>
      </div>
    </div>

    <!-- Response Modal -->
    <div class="response-modal hidden" id="response-modal">
      <div class="response-overlay"></div>
      <div class="response-content">
        <div class="response-header">
          <h2 id="response-modal-title">当前回答</h2>
          <button class="response-close" id="response-close">×</button>
        </div>
        <div class="response-body">
          <div id="response-content-text" class="response-text"></div>
        </div>
        <div class="response-footer">
          <button class="response-copy-btn" id="response-copy-btn">复制</button>
          <button class="response-close-btn" id="response-close-btn">关闭</button>
        </div>
      </div>
    </div>

    <section class="log">
      <h3>活动日志</h3>
      <div id="log-container"></div>
    </section>
  </div>

  <script src="panel.js"></script>
</body>
</html>
